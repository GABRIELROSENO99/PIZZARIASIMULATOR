<!DOCTYPE html>
<html lang="pt-BR">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  Â  <title>Pizzaria Helber B - Australian Man</title>
Â  Â  <script src="https://cdn.tailwindcss.com"></script>
Â  Â  <script>
Â  Â  Â  Â  tailwind.config = {
Â  Â  Â  Â  Â  Â  theme: {
Â  Â  Â  Â  Â  Â  Â  Â  extend: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  colors: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'aussie-orange': '#D96E01',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'aussie-green': '#00843D',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'bancada-brown': '#6D4C41',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'fundo-claro': '#FFF5E6',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  fontFamily: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  sans: ['Inter', 'sans-serif'],
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  </script>
Â  Â  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
Â  Â  <style>
Â  Â  Â  Â  /* Custom CSS para o tema Aussie */
Â  Â  Â  Â  body {
Â  Â  Â  Â  Â  Â  background-color: #f0f0f0;
Â  Â  Â  Â  Â  Â  font-family: 'Inter', sans-serif;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* AnimaÃ§Ã£o do fundo Aussie/RÃºstico */
Â  Â  Â  Â  .aussie-background {
Â  Â  Â  Â  Â  Â  background-image: url('https://placehold.co/1920x1080/D96E01/FFFFFF?text=FUNDO+R%C3%9ASTICO+PIZZARIA+AUSTRALIANA');
Â  Â  Â  Â  Â  Â  background-size: cover;
Â  Â  Â  Â  Â  Â  background-position: center;
Â  Â  Â  Â  Â  Â  background-repeat: no-repeat;
Â  Â  Â  Â  Â  Â  position: relative;
Â  Â  Â  Â  Â  Â  z-index: 1;
Â  Â  Â  Â  }

Â  Â  Â  Â  .aussie-background::before {
Â  Â  Â  Â  Â  Â  content: '';
Â  Â  Â  Â  Â  Â  position: absolute;
Â  Â  Â  Â  Â  Â  top: 0;
Â  Â  Â  Â  Â  Â  left: 0;
Â  Â  Â  Â  Â  Â  right: 0;
Â  Â  Â  Â  Â  Â  bottom: 0;
Â  Â  Â  Â  Â  Â  background: rgba(255, 255, 255, 0.8); /* Camada de opacidade para a UI */
Â  Â  Â  Â  Â  Â  z-index: 2;
Â  Â  Â  Â  }

Â  Â  Â  Â  #game-ui {
Â  Â  Â  Â  Â  Â  z-index: 3;
Â  Â  Â  Â  Â  Â  position: relative;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* Estilo da Bancada da Pizza */
Â  Â  Â  Â  #pizza-bench {
Â  Â  Â  Â  Â  Â  background-color: #bcaaa4; /* MÃ¡rmore claro/madeira */
Â  Â  Â  Â  Â  Â  border-radius: 1rem;
Â  Â  Â  Â  Â  Â  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
Â  Â  Â  Â  }

Â  Â  Â  Â  /* Estilo do Helber (Texto/Emoji) */
Â  Â  Â  Â  #helber-avatar {
Â  Â  Â  Â  Â  Â  font-size: 3rem;
Â  Â  Â  Â  Â  Â  animation: pulse 1s infinite alternate;
Â  Â  Â  Â  }

Â  Â  Â  Â  @keyframes pulse {
Â  Â  Â  Â  Â  Â  from { transform: scale(1); }
Â  Â  Â  Â  Â  Â  to { transform: scale(1.05); }
Â  Â  Â  Â  }

Â  Â  Â  Â  /* BotÃ£o de Ingrediente */
Â  Â  Â  Â  .ingredient-btn {
Â  Â  Â  Â  Â  Â  transition: transform 0.1s, box-shadow 0.1s;
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  }
Â  Â  Â  Â  .ingredient-btn:active {
Â  Â  Â  Â  Â  Â  transform: scale(0.95);
Â  Â  Â  Â  Â  Â  box-shadow: none;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* Pizza Stack - Visual Feedback */
Â  Â  Â  Â  #pizza-stack {
Â  Â  Â  Â  Â  Â  min-height: 200px;
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  flex-direction: column-reverse; /* Empilha de baixo para cima */
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  justify-content: center;
Â  Â  Â  Â  }
Â  Â  Â  Â  .pizza-layer {
Â  Â  Â  Â  Â  Â  width: 90%;
Â  Â  Â  Â  Â  Â  height: 20px;
Â  Â  Â  Â  Â  Â  border-radius: 50%;
Â  Â  Â  Â  Â  Â  margin-top: -10px; /* SobrepÃµe as camadas */
Â  Â  Â  Â  Â  Â  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
Â  Â  Â  Â  Â  Â  transition: all 0.2s ease-out;
Â  Â  Â  Â  }
Â  Â  Â  Â  .layer-molho { background-color: #c0392b; }
Â  Â  Â  Â  .layer-queijo { background-color: #f1c40f; }
Â  Â  Â  Â  .layer-carne { background-color: #8B4513; }
Â  Â  Â  Â  .layer-vegetal { background-color: #27ae60; }
Â  Â  Â  Â  .layer-premium { background-color: #9b59b6; }
Â  Â  Â  Â  .layer-abacaxi { background-color: #f39c12; }


Â  Â  Â  Â  /* Foguetes de ArtifÃ­cio (VitÃ³ria) */
Â  Â  Â  Â  .firework {
Â  Â  Â  Â  Â  Â  position: absolute;
Â  Â  Â  Â  Â  Â  width: 10px;
Â  Â  Â  Â  Â  Â  height: 10px;
Â  Â  Â  Â  Â  Â  background-color: red;
Â  Â  Â  Â  Â  Â  border-radius: 50%;
Â  Â  Â  Â  Â  Â  opacity: 0;
Â  Â  Â  Â  Â  Â  animation: firework-burst 0.8s ease-out forwards;
Â  Â  Â  Â  }

Â  Â  Â  Â  @keyframes firework-burst {
Â  Â  Â  Â  Â  Â  0% { opacity: 1; transform: translate(0, 0) scale(1); }
Â  Â  Â  Â  Â  Â  100% { opacity: 0; transform: translate(var(--x), var(--y)) scale(0.5); }
Â  Â  Â  Â  }

Â  Â  Â  Â  /* Timer Bar */
Â  Â  Â  Â  #timer-bar-fill {
Â  Â  Â  Â  Â  Â  /* TransiÃ§Ã£o ajustada para dar a sensaÃ§Ã£o de crescimento/acÃºmulo */
Â  Â  Â  Â  Â  Â  transition: width 0.1s linear;Â 
Â  Â  Â  Â  }
Â  Â  </style>
</head>
<body class="aussie-background min-h-screen p-4 md:p-8">

<div id="game-ui" class="max-w-7xl mx-auto">
Â  Â  <header class="bg-white/90 p-4 mb-6 rounded-xl shadow-lg border-t-4 border-aussie-green">
Â  Â  Â  Â  <div class="flex flex-col md:flex-row justify-between items-center text-center">
Â  Â  Â  Â  Â  Â  <h1 class="text-3xl font-black text-aussie-orange uppercase tracking-wider mb-2 md:mb-0">
Â  Â  Â  Â  Â  Â  Â  Â  Pizzaria Helber B - Australian Man ğŸ‡¦ğŸ‡º
Â  Â  Â  Â  Â  Â  </h1>
Â  Â  Â  Â  Â  Â  <div class="flex space-x-4 font-bold text-lg">
Â  Â  Â  Â  Â  Â  Â  Â  <span id="fase-counter" class="bg-aussie-green text-white px-3 py-1 rounded-full shadow-md">Fase: 1/5</span>
Â  Â  Â  Â  Â  Â  Â  Â  <span id="pizza-counter" class="bg-aussie-orange text-white px-3 py-1 rounded-full shadow-md">Pizzas: 0/25</span>
Â  Â  Â  Â  Â  Â  Â  Â  <span id="saldo-counter" class="bg-gray-700 text-white px-3 py-1 rounded-full shadow-md">Saldo: R$ 0</span>
Â  Â  Â  Â  Â  Â  Â  Â  <span id="highscore-display" class="bg-blue-600 text-white px-3 py-1 rounded-full shadow-md">Recorde: R$ 0</span>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div id="game-message" class="mt-3 text-center text-xl font-semibold text-gray-800">
Â  Â  Â  Â  Â  Â  Helber: "G'day, mate! Let's make some wicked pizzas today!"
Â  Â  Â  Â  </div>
Â  Â  </header>

Â  Â  <main class="grid grid-cols-1 lg:grid-cols-12 gap-6">

Â  Â  Â  Â  <div class="lg:col-span-3 space-y-6">
Â  Â  Â  Â  Â  Â  <div id="ingredients-shelf" class="bg-white/95 p-4 rounded-xl shadow-inner border border-aussie-green">
Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="text-xl font-bold mb-3 text-gray-800">Ingredientes ğŸ›’</h2>
Â  Â  Â  Â  Â  Â  Â  Â  <div id="ingredient-buttons" class="grid grid-cols-3 gap-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div class="bg-white/95 p-4 rounded-xl shadow-inner border border-aussie-orange max-h-96 overflow-y-auto">
Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="text-xl font-bold mb-3 text-aussie-green">Receitas (Ordem Exata!) ğŸ“œ</h2>
Â  Â  Â  Â  Â  Â  Â  Â  <div id="recipe-list" class="text-sm font-mono text-gray-700 space-y-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div class="lg:col-span-6 flex flex-col items-center space-y-4">
Â  Â  Â  Â  Â  Â  <div class="text-center">
Â  Â  Â  Â  Â  Â  Â  Â  <span id="helber-avatar">ğŸ‘¨â€ğŸ³ ğŸ‡¦ğŸ‡º</span>
Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-xl font-bold text-gray-800">Helber B.</p>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div id="pizza-bench" class="w-full max-w-lg h-80 flex flex-col items-center justify-center p-4">
Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="text-center text-lg font-semibold mb-4 text-white p-2 rounded-lg bg-gray-800/70">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Sua Pizza ğŸ•
Â  Â  Â  Â  Â  Â  Â  Â  </h3>
Â  Â  Â  Â  Â  Â  Â  Â  <div id="pizza-stack" class="w-64 h-64 border-8 border-dashed border-aussie-orange/50 rounded-full bg-aussie-orange/10 flex flex-col items-center justify-center">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p id="current-pizza-base" class="text-sm text-gray-600">Massa (Arraste o primeiro ingrediente)</p>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <button id="deliver-btn" disabled
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  class="w-full max-w-sm bg-gray-400 text-white font-black text-xl py-3 rounded-full shadow-lg transition duration-150 hover:bg-gray-500 disabled:opacity-50 disabled:cursor-not-allowed">
Â  Â  Â  Â  Â  Â  Â  Â  ENTREGAR AO CLIENTE ğŸš€
Â  Â  Â  Â  Â  Â  </button>

Â  Â  Â  Â  Â  Â  <div class="w-full max-w-lg mt-4 bg-gray-200 rounded-full h-4">
Â  Â  Â  Â  Â  Â  Â  Â  <div id="timer-bar-fill" class="bg-green-500 h-4 rounded-full" style="width: 0%;"></div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div class="lg:col-span-3 space-y-6">
Â  Â  Â  Â  Â  Â  <div id="order-queue" class="bg-white/95 p-4 rounded-xl shadow-inner border border-aussie-green">
Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="text-xl font-bold mb-3 text-gray-800">PrÃ³ximo Pedido ğŸ§‘â€ğŸ¤â€ğŸ§‘</h2>
Â  Â  Â  Â  Â  Â  Â  Â  <p id="customer-wait-timer" class="text-md font-bold text-green-600 mb-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  CLIENTE AGUARDANDO A (00:00)
Â  Â  Â  Â  Â  Â  Â  Â  </p>
Â  Â  Â  Â  Â  Â  Â  Â  <div id="current-order-card" class="bg-yellow-100 p-3 rounded-lg shadow-md border-l-4 border-yellow-500">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-sm text-gray-500">Cliente (Aguardando Helber)</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p id="customer-avatar" class="text-2xl mt-1">ğŸ„â€â™‚ï¸</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p id="current-order-name" class="text-xl font-black text-red-700 mt-2">...</p>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div id="feedback-area" class="bg-white/95 p-4 rounded-xl shadow-inner border border-aussie-orange min-h-[100px]">
Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="text-xl font-bold mb-3 text-gray-800">Feedback ğŸ—£ï¸</h2>
Â  Â  Â  Â  Â  Â  Â  Â  <p id="feedback-text" class="text-lg italic text-gray-600">Aguardando entrega...</p>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  </main>

Â  Â  <div id="game-modal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 hidden">
Â  Â  Â  Â  <div id="modal-content" class="bg-white p-8 rounded-xl shadow-2xl max-w-md w-full text-center border-t-8 border-aussie-orange">
Â  Â  Â  Â  Â  Â  <h2 id="modal-title" class="text-3xl font-black mb-4 text-aussie-green">Bem-vindo, Mate!</h2>
Â  Â  Â  Â  Â  Â  <p id="modal-body" class="mb-6 text-gray-700">Pressione Iniciar para comeÃ§ar sua jornada como o Pizzaiolo Helber B!</p>
Â  Â  Â  Â  Â  Â  <div id="modal-actions">
Â  Â  Â  Â  Â  Â  Â  Â  <button id="start-game-btn" class="bg-aussie-orange text-white font-bold py-3 px-6 rounded-full text-lg transition duration-150 hover:bg-aussie-green">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Iniciar Dia 1 ğŸ•
Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  </div>

</div>

<script type="module">
Â  Â  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
Â  Â  import { getAuth, signInAnonymously, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
Â  Â  import { getFirestore, doc, setDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
Â  Â  import { setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

Â  Â  // VariÃ¡veis globais de ambiente (PREENCHIDAS PELO CANVAS)
Â  Â  const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
Â  Â  const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : null;
Â  Â  const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

Â  Â  // ConfiguraÃ§Ãµes e VariÃ¡veis Globais do Jogo
Â  Â  let GAME_STATE = {
Â  Â  Â  Â  currentPhase: 1,
Â  Â  Â  Â  pizzasCompleted: 0,
Â  Â  Â  Â  balance: 0,
Â  Â  Â  Â  highScore: 0,
Â  Â  Â  Â  streak: 0,
Â  Â  Â  Â  isGameRunning: false,
Â  Â  Â  Â  currentOrder: null,
Â  Â  Â  Â  appliedIngredients: [],
Â  Â  Â  Â  phaseGoal: 25,
Â  Â  Â  Â  timerMax: 0,
Â  Â  Â  Â  elapsedTime: 0, // ALTERADO: ContarÃ¡ o tempo que passou.
Â  Â  Â  Â  isAuthReady: false,
Â  Â  Â  Â  userId: null,
Â  Â  };

Â  Â  const INGREDIENTS = {
Â  Â  Â  Â  'MOLHO': { color: '#c0392b', emoji: 'ğŸ¥«', type: 'layer-molho' },
Â  Â  Â  Â  'QUEIJO': { color: '#f1c40f', emoji: 'ğŸ§€', type: 'layer-queijo' },
Â  Â  Â  Â  'CALABRESA': { color: '#e74c3c', emoji: 'ğŸ¥©', type: 'layer-carne' },
Â  Â  Â  Â  'PEPPERONI': { color: '#c0392b', emoji: 'ğŸŒ¶ï¸', type: 'layer-carne' },
Â  Â  Â  Â  'FRANGO': { color: '#f39c12', emoji: 'ğŸ”', type: 'layer-carne' },
Â  Â  Â  Â  'CATUPIRY': { color: '#ecf0f1', emoji: 'ğŸ¥›', type: 'layer-queijo' },
Â  Â  Â  Â  'MANJERICÃƒO': { color: '#2ecc71', emoji: 'ğŸŒ¿', type: 'layer-vegetal' },
Â  Â  Â  Â  'ORÃ‰GANO': { color: '#27ae60', emoji: 'ğŸƒ', type: 'layer-vegetal' },
Â  Â  Â  Â  'CEBOLA': { color: '#bdc3c7', emoji: 'ğŸ§…', type: 'layer-vegetal' },
Â  Â  Â  Â  'COGUMELOS': { color: '#95a5a6', emoji: 'ğŸ„', type: 'layer-vegetal' },
Â  Â  Â  Â  'GORGONZOLA': { color: '#3498db', emoji: 'ğŸ§€', type: 'layer-queijo' },
Â  Â  Â  Â  'PROVOLONE': { color: '#9b59b6', emoji: 'ğŸ§€', type: 'layer-queijo' },
Â  Â  Â  Â  'BACON': { color: '#e67e22', emoji: 'ğŸ¥“', type: 'layer-carne' },
Â  Â  Â  Â  'AZEITONAS': { color: '#2c3e50', emoji: 'âš«', type: 'layer-vegetal' },
Â  Â  Â  Â  'PIMENTÃƒO': { color: '#e67e22', emoji: 'ğŸ«‘', type: 'layer-vegetal' },
Â  Â  Â  Â  'ABACAXI': { color: '#f1c40f', emoji: 'ğŸ', type: 'layer-abacaxi' },
Â  Â  Â  Â  'PRESUNTO': { color: '#e67e22', emoji: 'ğŸ–', type: 'layer-carne' },
Â  Â  Â  Â  'PARMESÃƒO': { color: '#f39c12', emoji: 'ğŸ§€', type: 'layer-queijo' },
Â  Â  Â  Â  'BRÃ“COLIS': { color: '#2ecc71', emoji: 'ğŸ¥¦', type: 'layer-vegetal' },
Â  Â  Â  Â  'QUEIJO EXTRA': { color: '#f1c40f', emoji: 'ğŸ§€', type: 'layer-queijo' },
Â  Â  Â  Â  'CARNE MOÃDA': { color: '#8B4513', emoji: 'ğŸ¥©', type: 'layer-carne' },
Â  Â  Â  Â  'ATUM': { color: '#2c3e50', emoji: 'ğŸŸ', type: 'layer-carne' },
Â  Â  Â  Â  'ESCARGOT': { color: '#9b59b6', emoji: 'ğŸŒ', type: 'layer-premium' },
Â  Â  };

Â  Â  const RECIPES = {
Â  Â  Â  Â  'MARGHERITA': { ingredients: ['MOLHO', 'QUEIJO', 'MANJERICÃƒO'], price: 50, phaseMin: 1 },
Â  Â  Â  Â  'CALABRESA': { ingredients: ['MOLHO', 'QUEIJO', 'CALABRESA', 'CEBOLA'], price: 60, phaseMin: 1 },
Â  Â  Â  Â  'FRANGO CATUPIRY': { ingredients: ['MOLHO', 'QUEIJO', 'FRANGO', 'CATUPIRY'], price: 70, phaseMin: 1 },
Â  Â  Â  Â  'PEPPERONI': { ingredients: ['MOLHO', 'QUEIJO', 'PEPPERONI', 'ORÃ‰GANO'], price: 75, phaseMin: 1 },
Â  Â  Â  Â  'BACON': { ingredients: ['MOLHO', 'QUEIJO', 'BACON', 'CEBOLA'], price: 70, phaseMin: 1 },
Â  Â  Â  Â  'QUATRO QUEIJOS': { ingredients: ['MOLHO', 'QUEIJO', 'GORGONZOLA', 'PROVOLONE', 'PARMESÃƒO'], price: 90, phaseMin: 2 },
Â  Â  Â  Â  'COGUMELOS': { ingredients: ['MOLHO', 'QUEIJO', 'COGUMELOS', 'MANJERICÃƒO'], price: 65, phaseMin: 2 },
Â  Â  Â  Â  'HAWAIIAN': { ingredients: ['MOLHO', 'QUEIJO', 'PRESUNTO', 'ABACAXI'], price: 80, phaseMin: 2 },
Â  Â  Â  Â  'AZEITONA': { ingredients: ['MOLHO', 'QUEIJO', 'AZEITONAS', 'PIMENTÃƒO'], price: 60, phaseMin: 3 },
Â  Â  Â  Â  'BRÃ“COLIS': { ingredients: ['MOLHO', 'QUEIJO', 'BRÃ“COLIS', 'QUEIJO EXTRA'], price: 85, phaseMin: 3 },
Â  Â  Â  Â  'CARNE': { ingredients: ['MOLHO', 'QUEIJO', 'CARNE MOÃDA', 'CEBOLA'], price: 70, phaseMin: 4 },
Â  Â  Â  Â  'ATUM': { ingredients: ['MOLHO', 'QUEIJO', 'ATUM', 'ORÃ‰GANO'], price: 65, phaseMin: 4 },
Â  Â  Â  Â  'ESCARGOT': { ingredients: ['MOLHO', 'QUEIJO', 'ESCARGOT', 'MANJERICÃƒO'], price: 120, phaseMin: 5 }, // Premium
Â  Â  Â  Â  'VEGETARIANA': { ingredients: ['MOLHO', 'QUEIJO', 'PIMENTÃƒO', 'COGUMELOS', 'ABACAXI'], price: 95, phaseMin: 5 },
Â  Â  Â  Â  'SUPREMA': { ingredients: ['MOLHO', 'QUEIJO', 'PEPPERONI', 'BACON', 'COGUMELOS', 'PIMENTÃƒO'], price: 110, phaseMin: 5 },
Â  Â  };

Â  Â  const PHASES = {
Â  Â  Â  Â  1: { goal: 2, timer: 0, available: ['MARGHERITA', 'CALABRESA', 'FRANGO CATUPIRY', 'PEPPERONI', 'BACON'], message: "Dia de treino! Sem pressÃ£o, mate!" }, // Reduzido goal para teste
Â  Â  Â  Â  2: { goal: 5, timer: 120, available: 8, message: "Aperta o passo! O relÃ³gio estÃ¡ correndo, cobber!" }, // Reduzido goal para teste
Â  Â  Â  Â  3: { goal: 5, timer: 105, available: 12, message: "A clientela estÃ¡ agitada, menos tempo para errar!" },
Â  Â  Â  Â  4: { goal: 5, timer: 90, available: 15, message: "Dia de super-pico! Pedidos piscando!" },
Â  Â  Â  Â  5: { goal: 5, timer: 75, available: 15, message: "Final do campeonato! Acerto triplo Ã© dinheiro extra!" },
Â  Â  };

Â  Â  // Frases de elogio expandidas com o tema Brasil/SÃ£o Paulo
Â  Â  const PRAISE_PHRASES = [
Â  Â  Â  Â  "Deliciosa mate!", "Perfeita, cobber!", "A melhor da AustrÃ¡lia!", "Queijo derretido top!",
Â  Â  Â  Â  "Simplesmente perfeito!", "Dez de dez!", "Eu voltarei!", "FantÃ¡stico!", "Sabor impecÃ¡vel, mate!",
Â  Â  Â  Â  "Muito bom, amigo!", "Que fatia de pizza!", "Obrigado, lenda!",
Â  Â  Â  Â  "Entrega incrivelmente rÃ¡pida! VocÃª Ã© um foguete, Helber!",
Â  Â  Â  Â  "Helber Ã© o mestre da velocidade! Ripper!",
Â  Â  Â  Â  "Essa rapidez Ã© nota 10! NÃ£o deu tempo nem de piscar!",
Â  Â  Â  Â  "Ã‰ sabor de SÃ£o Paulo, Helber! Que saudade da pizza brasileira!",
Â  Â  Â  Â  "Esse queijo lembra o da Mooca! Sabor de casa!",
Â  Â  Â  Â  "Atendimento Aussie, sabor brasileiro. CombinaÃ§Ã£o perfeita!",
Â  Â  ];

Â  Â  const HELBER_SPEAK = {
Â  Â  Â  Â  START: "G'day, mate! Let's make some wicked pizzas today!",
Â  Â  Â  Â  CORRECT: "Fair dinkum! Nailed it, mate! Get that dough!",
Â  Â  Â  Â  WRONG: "Crikey! That's gone belly up. Try again, cobber!",
Â  Â  Â  Â  NEXT_PHASE: "Ripper! We smashed that day. Now for the next one!",
Â  Â  Â  Â  VICTORY: "You beaut! We did it! Pizza empire, here we come!",
Â  Â  };

Â  Â  let timerInterval = null;
Â  Â  let comboStreak = 0;

Â  Â  // --- DOM Elements ---
Â  Â  const elements = {
Â  Â  Â  Â  faseCounter: document.getElementById('fase-counter'),
Â  Â  Â  Â  pizzaCounter: document.getElementById('pizza-counter'),
Â  Â  Â  Â  saldoCounter: document.getElementById('saldo-counter'),
Â  Â  Â  Â  highscoreDisplay: document.getElementById('highscore-display'),
Â  Â  Â  Â  gameMessage: document.getElementById('game-message'),
Â  Â  Â  Â  ingredientButtons: document.getElementById('ingredient-buttons'),
Â  Â  Â  Â  recipeList: document.getElementById('recipe-list'),
Â  Â  Â  Â  pizzaStack: document.getElementById('pizza-stack'),
Â  Â  Â  Â  deliverBtn: document.getElementById('deliver-btn'),
Â  Â  Â  Â  currentOrderName: document.getElementById('current-order-name'),
Â  Â  Â  Â  customerAvatar: document.getElementById('customer-avatar'),
Â  Â  Â  Â  feedbackText: document.getElementById('feedback-text'),
Â  Â  Â  Â  timerBarFill: document.getElementById('timer-bar-fill'),
Â  Â  Â  Â  gameModal: document.getElementById('game-modal'),
Â  Â  Â  Â  modalTitle: document.getElementById('modal-title'),
Â  Â  Â  Â  modalBody: document.getElementById('modal-body'),
Â  Â  Â  Â  modalActions: document.getElementById('modal-actions'),
Â  Â  Â  Â  startGameBtn: document.getElementById('start-game-btn'),
Â  Â  Â  Â  currentPizzaBase: document.getElementById('current-pizza-base'),
Â  Â  Â  Â  customerWaitTimer: document.getElementById('customer-wait-timer'),
Â  Â  };

Â  Â  // --- Firebase Setup (Mantido como estava) ---
Â  Â  let db, auth;

Â  Â  async function initFirebase() {
Â  Â  Â  Â  if (!firebaseConfig) {
Â  Â  Â  Â  Â  Â  console.error("Firebase config not available. Running game without persistence.");
Â  Â  Â  Â  Â  Â  GAME_STATE.isAuthReady = true;
Â  Â  Â  Â  Â  Â  elements.highscoreDisplay.textContent = "Recorde: R$ 0 (Local)";
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }
Â Â  Â  Â  Â 
Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  // ... (LÃ³gica de inicializaÃ§Ã£o Firebase omitida para brevidade, mas mantida no cÃ³digo original)
Â  Â  Â  Â  Â  Â  const app = initializeApp(firebaseConfig);
Â  Â  Â  Â  Â  Â  db = getFirestore(app);
Â  Â  Â  Â  Â  Â  auth = getAuth(app);
Â  Â  Â  Â  Â  Â  setLogLevel('debug'); // Log level for Firestore

Â  Â  Â  Â  Â  Â  let userCredential;
Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  if (initialAuthToken) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  userCredential = await signInWithCustomToken(auth, initialAuthToken);
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  userCredential = await signInAnonymously(auth);
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  userCredential = await signInAnonymously(auth);
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  GAME_STATE.userId = userCredential.user.uid;
Â  Â  Â  Â  Â  Â  GAME_STATE.isAuthReady = true;
Â  Â  Â  Â  Â  Â  loadGameState();Â 

Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  console.error("Erro fatal ao inicializar Firebase ou Autenticar:", error);
Â  Â  Â  Â  Â  Â  GAME_STATE.isAuthReady = true;
Â  Â  Â  Â  Â  Â  elements.highscoreDisplay.textContent = "Recorde: R$ 0 (Erro Auth)";
Â  Â  Â  Â  }
Â  Â  }

Â  Â  function getUserScoreDocRef() {
Â  Â  Â  Â  if (!db || !GAME_STATE.userId) return null;
Â  Â  Â  Â  const collectionPath = `/artifacts/${appId}/users/${GAME_STATE.userId}/pizzagame_scores`;
Â  Â  Â  Â  return doc(db, collectionPath, 'high_score');
Â  Â  }

Â  Â  function loadGameState() {
Â  Â  Â  Â  if (!GAME_STATE.isAuthReady || !db || !GAME_STATE.userId) return;

Â  Â  Â  Â  const docRef = getUserScoreDocRef();
Â  Â  Â  Â  if (!docRef) return;

Â  Â  Â  Â  onSnapshot(docRef, (docSnap) => {
Â  Â  Â  Â  Â  Â  if (docSnap.exists()) {
Â  Â  Â  Â  Â  Â  Â  Â  const data = docSnap.data();
Â  Â  Â  Â  Â  Â  Â  Â  GAME_STATE.highScore = data.highScore || 0;
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  saveGameState();Â 
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  updateUI();
Â  Â  Â  Â  }, (error) => {
Â  Â  Â  Â  Â  Â  console.error("Erro ao ouvir High Score:", error);
Â  Â  Â  Â  });
Â  Â  }

Â  Â  async function saveGameState() {
Â  Â  Â  Â  if (!GAME_STATE.isAuthReady || !db || !GAME_STATE.userId) return;

Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  const docRef = getUserScoreDocRef();
Â  Â  Â  Â  Â  Â  if (!docRef) return;

Â  Â  Â  Â  Â  Â  await setDoc(docRef, {
Â  Â  Â  Â  Â  Â  Â  Â  highScore: GAME_STATE.highScore,
Â  Â  Â  Â  Â  Â  Â  Â  lastUpdated: new Date().toISOString()
Â  Â  Â  Â  Â  Â  }, { merge: true });
Â  Â  Â  Â  } catch (e) {
Â  Â  Â  Â  Â  Â  console.error("Erro ao salvar High Score:", e);
Â  Â  Â  Â  }
Â  Â  }

Â  Â  // --- Web Speech Synthesis (Helber's Voice) (Mantido como estava) ---

Â  Â  function helberSpeak(text) {
Â  Â  Â  Â  if ('speechSynthesis' in window) {
Â  Â  Â  Â  Â  Â  const utterance = new SpeechSynthesisUtterance(text);
Â  Â  Â  Â  Â  Â  utterance.lang = 'en-US';Â 

Â  Â  Â  Â  Â  Â  const voices = window.speechSynthesis.getVoices();
Â  Â  Â  Â  Â  Â  let aussieVoice = voices.find(voice => voice.lang === 'en-AU');

Â  Â  Â  Â  Â  Â  if (aussieVoice) {
Â  Â  Â  Â  Â  Â  Â  Â  utterance.voice = aussieVoice;
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  utterance.voice = voices[0] || null;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  utterance.rate = 1.0;
Â  Â  Â  Â  Â  Â  utterance.pitch = 1.0;
Â  Â  Â  Â  Â  Â  window.speechSynthesis.speak(utterance);
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  console.warn("Speech Synthesis nÃ£o suportado neste navegador.");
Â  Â  Â  Â  }
Â  Â  }

Â  Â  // --- Game Logic ---

Â  Â  function startGame() {
Â  Â  Â  Â  GAME_STATE.currentPhase = 1;
Â  Â  Â  Â  GAME_STATE.balance = 0;
Â  Â  Â  Â  GAME_STATE.streak = 0;
Â  Â  Â  Â  GAME_STATE.isGameRunning = true;
Â  Â  Â  Â  hideModal();
Â  Â  Â  Â  startPhase();
Â  Â  Â  Â  helberSpeak(HELBER_SPEAK.START);
Â  Â  }

Â  Â  function startPhase() {
Â  Â  Â  Â  const phase = PHASES[GAME_STATE.currentPhase];
Â  Â  Â  Â  GAME_STATE.pizzasCompleted = 0;
Â  Â  Â  Â  GAME_STATE.phaseGoal = phase.goal;
Â  Â  Â  Â  GAME_STATE.timerMax = phase.timer * 1000;
Â  Â  Â  Â  GAME_STATE.elapsedTime = 0; // Reset do tempo
Â  Â  Â  Â  GAME_STATE.appliedIngredients = [];
Â  Â  Â  Â  resetPizzaBench();
Â  Â  Â  Â  updateUI();
Â  Â  Â  Â  displayMessage(phase.message);

Â  Â  Â  Â  if (GAME_STATE.currentPhase === 1) {
Â  Â  Â  Â  Â  Â  generateNextOrder();
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  GAME_STATE.currentOrder = null;Â 
Â  Â  Â  Â  }
Â  Â  }

Â  Â  /**
Â Â  Â  * Retorna a lista de nomes de ingredientes que estÃ£o em *qualquer* receita
Â Â  Â  * disponÃ­vel para a fase atual.
Â Â  Â  */
Â  Â  function getAvailableIngredientsForPhase() {
Â  Â  Â  Â  const availableRecipes = Object.keys(RECIPES).filter(name => RECIPES[name].phaseMin <= GAME_STATE.currentPhase);
Â  Â  Â  Â  const uniqueIngredients = new Set();
Â Â  Â  Â  Â 
Â  Â  Â  Â  availableRecipes.forEach(rName => {
Â  Â  Â  Â  Â  Â  RECIPES[rName].ingredients.forEach(iName => {
Â  Â  Â  Â  Â  Â  Â  Â  uniqueIngredients.add(iName);
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  });

Â  Â  Â  Â  // Na Fase 1, se tivermos uma lista restrita de receitas, usamos elas.
Â  Â  Â  Â  if (GAME_STATE.currentPhase === 1) {
Â  Â  Â  Â  Â  Â  const phase1Recipes = PHASES[1].available; // Nomes das receitas
Â  Â  Â  Â  Â  Â  const phase1Ingredients = new Set();
Â  Â  Â  Â  Â  Â  phase1Recipes.forEach(rName => {
Â Â  Â  Â  Â  Â  Â  Â  Â  if (RECIPES[rName]) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  RECIPES[rName].ingredients.forEach(iName => phase1Ingredients.add(iName));
Â Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  return Array.from(phase1Ingredients);
Â  Â  Â  Â  }

Â  Â  Â  Â  return Array.from(uniqueIngredients);
Â  Â  }


Â  Â  function generateNextOrder() {
Â  Â  Â  Â  const allRecipes = Object.keys(RECIPES).filter(name => RECIPES[name].phaseMin <= GAME_STATE.currentPhase);
Â  Â  Â  Â  let availableRecipes = allRecipes;

Â  Â  Â  Â  if (GAME_STATE.currentPhase === 1) {
Â  Â  Â  Â  Â  Â  availableRecipes = PHASES[1].available; // Usa a lista restrita de nomes de receita
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  // Se a fase tem um limite de receitas (o nÃºmero em 'available'), usa um subconjunto
Â  Â  Â  Â  Â  Â  const numAvailable = PHASES[GAME_STATE.currentPhase].available;
Â  Â  Â  Â  Â  Â  availableRecipes = allRecipes.slice(0, numAvailable);Â 
Â  Â  Â  Â  }

Â  Â  Â  Â  const randomRecipeName = availableRecipes[Math.floor(Math.random() * availableRecipes.length)];
Â  Â  Â  Â  const order = RECIPES[randomRecipeName];

Â  Â  Â  Â  GAME_STATE.currentOrder = {
Â  Â  Â  Â  Â  Â  name: randomRecipeName,
Â  Â  Â  Â  Â  Â  recipe: order.ingredients,
Â  Â  Â  Â  Â  Â  price: order.price,
Â  Â  Â  Â  };

Â  Â  Â  Â  elements.currentOrderName.textContent = randomRecipeName;
Â  Â  Â  Â  elements.customerAvatar.textContent = getRandomCustomerEmoji();

Â  Â  Â  Â  // O timer sÃ³ comeÃ§a a contar quando o pedido Ã© gerado
Â  Â  Â  Â  resetTimer(GAME_STATE.timerMax);
Â  Â  Â  Â  updateUI();
Â  Â  }

Â  Â  function addIngredient(ingredientName) {
Â  Â  Â  Â  if (!GAME_STATE.isGameRunning || !GAME_STATE.currentOrder) return;

Â  Â  Â  Â  GAME_STATE.appliedIngredients.push(ingredientName);
Â  Â  Â  Â  renderPizzaStack();
Â  Â  Â  Â  updateUI();Â 
Â  Â  }

Â  Â  function deliverPizza() {
Â  Â  Â  Â  if (GAME_STATE.appliedIngredients.length === 0 || !GAME_STATE.currentOrder) return;
Â  Â  Â  Â  stopTimer();

Â  Â  Â  Â  const correctRecipe = GAME_STATE.currentOrder.recipe;
Â  Â  Â  Â  const applied = GAME_STATE.appliedIngredients;

Â  Â  Â  Â  // 1. Verifica o tamanho
Â  Â  Â  Â  if (applied.length !== correctRecipe.length) {
Â  Â  Â  Â  Â  Â  handleWrongOrder("Falta ou sobra de ingredientes, Helber!");
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }

Â  Â  Â  Â  // 2. Verifica a ordem exata
Â  Â  Â  Â  let isCorrect = true;
Â  Â  Â  Â  for (let i = 0; i < correctRecipe.length; i++) {
Â  Â  Â  Â  Â  Â  if (applied[i] !== correctRecipe[i]) {
Â  Â  Â  Â  Â  Â  Â  Â  isCorrect = false;
Â  Â  Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  if (isCorrect) {
Â  Â  Â  Â  Â  Â  handleCorrectOrder();
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  handleWrongOrder("A ordem dos ingredientes estÃ¡ errada, cobber!");
Â  Â  Â  Â  }
Â  Â  }

Â  Â  function handleCorrectOrder() {
Â  Â  Â  Â  let price = GAME_STATE.currentOrder.price;
Â  Â  Â  Â  comboStreak++;

Â  Â  Â  Â  if (comboStreak >= 5) {
Â  Â  Â  Â  Â  Â  price = Math.round(price * 1.5);Â 
Â  Â  Â  Â  Â  Â  elements.feedbackText.textContent = `ğŸ”¥ STREAK x1.5! Pizza perfeita! +R$${price}`;
Â  Â  Â  Â  Â  Â  displayMessage(HELBER_SPEAK.CORRECT, 'text-green-700 font-extrabold');
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  const praise = getRandomPraisePhrase();
Â  Â  Â  Â  Â  Â  elements.feedbackText.textContent = praise;
Â  Â  Â  Â  Â  Â  displayMessage(HELBER_SPEAK.CORRECT, 'text-green-600');
Â  Â  Â  Â  }

Â  Â  Â  Â  if (GAME_STATE.currentPhase === 5 && comboStreak > 0 && comboStreak % 3 === 0) {
Â  Â  Â  Â  Â  Â  price *= 2;Â 
Â  Â  Â  Â  Â  Â  elements.feedbackText.textContent = `âœ¨ COMBO ESPECIAL X2! +R$${price} | ${elements.feedbackText.textContent}`;
Â  Â  Â  Â  }

Â  Â  Â  Â  GAME_STATE.balance += price;
Â  Â  Â  Â  GAME_STATE.pizzasCompleted++;

Â  Â  Â  Â  helberSpeak(HELBER_SPEAK.CORRECT);
Â  Â  Â  Â  animatePizzaDelivery();

Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  continueGameFlow();
Â  Â  Â  Â  }, 1500);
Â  Â  }

Â  Â  function handleWrongOrder(reason) {
Â  Â  Â  Â  GAME_STATE.balance = Math.max(0, GAME_STATE.balance - 20);Â 
Â  Â  Â  Â  comboStreak = 0;
Â  Â  Â  Â  elements.feedbackText.textContent = `âŒ Penalidade (-R$20). ${reason}`;
Â  Â  Â  Â  displayMessage(`âŒ Crikey! That's gone belly up. Try again, cobber!`, 'text-red-600');
Â  Â  Â  Â  helberSpeak(HELBER_SPEAK.WRONG);
Â  Â  Â  Â  animatePizzaExplosion();
Â Â  Â  Â  Â 
Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  continueGameFlow();
Â  Â  Â  Â  }, 1500);
Â  Â  }

Â  Â  function continueGameFlow() {
Â  Â  Â  Â  if (GAME_STATE.pizzasCompleted >= GAME_STATE.phaseGoal) {
Â  Â  Â  Â  Â  Â  stopTimer();
Â  Â  Â  Â  Â  Â  if (GAME_STATE.currentPhase < 5) {
Â  Â  Â  Â  Â  Â  Â  Â  GAME_STATE.currentPhase++;
Â Â  Â  Â  Â  Â  Â  Â  Â 
Â  Â  Â  Â  Â  Â  Â  Â  startPhase();Â 

Â  Â  Â  Â  Â  Â  Â  Â  showModal(`Fim do Dia ${GAME_STATE.currentPhase - 1}`,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `R$ ${GAME_STATE.balance} ganhos hoje! Prepare-se para o Dia ${GAME_STATE.currentPhase}.`,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'nextPhase');

Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  endGame(true);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  resetPizzaBench();Â 
Â  Â  Â  Â  Â  Â  updateUI();
Â  Â  Â  Â  Â  Â  generateNextOrder();
Â  Â  Â  Â  }
Â  Â  }


Â  Â  function endGame(isVictory) {
Â  Â  Â  Â  GAME_STATE.isGameRunning = false;
Â  Â  Â  Â  stopTimer();

Â  Â  Â  Â  if (GAME_STATE.balance > GAME_STATE.highScore) {
Â  Â  Â  Â  Â  Â  GAME_STATE.highScore = GAME_STATE.balance;
Â  Â  Â  Â  Â  Â  saveGameState();
Â  Â  Â  Â  }

Â  Â  Â  Â  if (isVictory) {
Â  Â  Â  Â  Â  Â  helberSpeak(HELBER_SPEAK.VICTORY);
Â  Â  Â  Â  Â  Â  showModal("PARABÃ‰NS, HELBER! VITÃ“RIA!",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `VOCÃŠ CONSEGUIU DINHEIRO SUFICIENTE PARA MONTAR UMA PIZZARIA NA AUSTRÃLIA! Saldo Final: R$ ${GAME_STATE.balance}`,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'endGame', true);
Â  Â  Â  Â  Â  Â  animateFireworks();
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  showModal("Fim de Jogo ğŸ˜”",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `VocÃª nÃ£o atingiu a meta. Saldo Final: R$ ${GAME_STATE.balance}`,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'endGame');
Â  Â  Â  Â  }
Â  Â  }

Â  Â  // --- UI Rendering ---

Â  Â  function updateUI() {
Â  Â  Â  Â  elements.faseCounter.textContent = `Fase: ${GAME_STATE.currentPhase}/5`;
Â  Â  Â  Â  elements.pizzaCounter.textContent = `Pizzas: ${GAME_STATE.pizzasCompleted}/${GAME_STATE.phaseGoal}`;
Â  Â  Â  Â  elements.saldoCounter.textContent = `Saldo: R$ ${GAME_STATE.balance}`;
Â  Â  Â  Â  elements.highscoreDisplay.textContent = `Recorde: R$ ${GAME_STATE.highScore}`;
Â Â  Â  Â  Â 
Â  Â  Â  Â  const canDeliver = GAME_STATE.isGameRunning && GAME_STATE.currentOrder && GAME_STATE.appliedIngredients.length > 0;
Â  Â  Â  Â  elements.deliverBtn.disabled = !canDeliver;
Â  Â  Â  Â  elements.deliverBtn.classList.remove('bg-aussie-orange', 'bg-gray-400');
Â  Â  Â  Â  elements.deliverBtn.classList.add(canDeliver ? 'bg-aussie-orange' : 'bg-gray-400');
Â  Â  Â  Â  elements.deliverBtn.classList.remove('hover:bg-aussie-green', 'hover:bg-gray-500');
Â  Â  Â  Â  elements.deliverBtn.classList.add(canDeliver ? 'hover:bg-aussie-green' : 'hover:bg-gray-500');

Â  Â  Â  Â  renderIngredientButtons();
Â  Â  Â  Â  renderRecipeList();
Â  Â  Â  Â  renderPizzaStack();Â 
Â  Â  }

Â  Â  /**
Â Â  Â  * Renderiza os botÃµes de ingredientes disponÃ­veis. (Corrigido)
Â Â  Â  */
Â  Â  function renderIngredientButtons() {
Â  Â  Â  Â  const container = elements.ingredientButtons;
Â  Â  Â  Â  container.innerHTML = '';
Â Â  Â  Â  Â 
Â  Â  Â  Â  // ObtÃ©m apenas os nomes dos ingredientes necessÃ¡rios nas receitas da fase atual
Â  Â  Â  Â  const availableIngredients = getAvailableIngredientsForPhase();

Â  Â  Â  Â  Object.keys(INGREDIENTS).forEach(name => {
Â  Â  Â  Â  Â  Â  const ingredient = INGREDIENTS[name];
Â Â  Â  Â  Â  Â  Â 
Â  Â  Â  Â  Â  Â  // Verifica se o ingrediente estÃ¡ na lista de disponÃ­veis para a fase
Â  Â  Â  Â  Â  Â  const isAvailable = availableIngredients.includes(name);

Â  Â  Â  Â  Â  Â  const button = document.createElement('button');
Â  Â  Â  Â  Â  Â  button.className = `ingredient-btn p-2 rounded-lg text-xs font-bold shadow-md flex flex-col items-center transition duration-100 ${isAvailable ? 'bg-fundo-claro border-2 border-aussie-green hover:bg-aussie-green/20' : 'bg-gray-200 text-gray-400 cursor-not-allowed'}`;
Â  Â  Â  Â  Â  Â  button.disabled = !isAvailable;
Â  Â  Â  Â  Â  Â  button.innerHTML = `<span class="text-xl">${ingredient.emoji}</span>${name}`;
Â Â  Â  Â  Â  Â  Â 
Â  Â  Â  Â  Â  Â  if (isAvailable) {
Â  Â  Â  Â  Â  Â  Â  Â  button.onclick = () => addIngredient(name);
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  container.appendChild(button);
Â  Â  Â  Â  });
Â  Â  }

Â  Â  function renderRecipeList() {
Â  Â  Â  Â  const container = elements.recipeList;
Â  Â  Â  Â  container.innerHTML = '';

Â  Â  Â  Â  const availableRecipes = Object.keys(RECIPES)
Â  Â  Â  Â  Â  Â  .filter(name => RECIPES[name].phaseMin <= GAME_STATE.currentPhase);
Â Â  Â  Â  Â 
Â  Â  Â  Â  // Se Fase 1, usa a lista restrita para exibir apenas as que realmente aparecerÃ£o
Â  Â  Â  Â  const recipesToDisplay = GAME_STATE.currentPhase === 1Â 
Â  Â  Â  Â  Â  Â  ? PHASES[1].available.map(name => ({ name, recipe: RECIPES[name] }))
Â  Â  Â  Â  Â  Â  : availableRecipes.map(name => ({ name, recipe: RECIPES[name] }));


Â  Â  Â  Â  recipesToDisplay.forEach(item => {
Â  Â  Â  Â  Â  Â  const { name, recipe } = item;
Â  Â  Â  Â  Â  Â  const detail = recipe.ingredients.join(' - '); // Cria o detalhe da receita

Â  Â  Â  Â  Â  Â  const itemDiv = document.createElement('div');
Â  Â  Â  Â  Â  Â  itemDiv.className = 'border-b border-gray-200 pb-1';
Â  Â  Â  Â  Â  Â  itemDiv.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex items-center space-x-1">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="font-bold text-md text-aussie-orange">${name} (R$${recipe.price})</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="text-aussie-green text-lg" title="Ingredientes da Receita">â“˜</span>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-xs text-gray-500 truncate">${detail}</p>
Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  container.appendChild(itemDiv);
Â  Â  Â  Â  });
Â  Â  }

Â  Â  function renderPizzaStack() {
Â  Â  Â  Â  const stack = elements.pizzaStack;
Â  Â  Â  Â  stack.innerHTML = '';
Â Â  Â  Â  Â 
Â  Â  Â  Â  if (GAME_STATE.appliedIngredients.length === 0) {
Â  Â  Â  Â  Â  Â  elements.currentPizzaBase.style.display = 'block';
Â  Â  Â  Â  Â  Â  elements.currentPizzaBase.textContent = "Massa (Arraste o primeiro ingrediente)";
Â  Â  Â  Â  Â  Â  stack.appendChild(elements.currentPizzaBase);
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  elements.currentPizzaBase.style.display = 'none';
Â  Â  Â  Â  }

Â  Â  Â  Â  // Camada de Base (Massa)
Â  Â  Â  Â  const baseLayer = document.createElement('div');
Â  Â  Â  Â  baseLayer.className = 'pizza-layer w-72 h-10 bg-yellow-700 shadow-xl transition-all duration-300';
Â  Â  Â  Â  baseLayer.style.marginTop = '0px';Â 
Â  Â  Â  Â  stack.appendChild(baseLayer);

Â  Â  Â  Â  GAME_STATE.appliedIngredients.forEach(ingredientName => {
Â  Â  Â  Â  Â  Â  const ingredient = INGREDIENTS[ingredientName];
Â  Â  Â  Â  Â  Â  const layerDiv = document.createElement('div');
Â  Â  Â  Â  Â  Â  layerDiv.className = `pizza-layer ${ingredient.type} text-center text-xs font-bold text-white flex items-center justify-center`;
Â  Â  Â  Â  Â  Â  layerDiv.textContent = ingredient.emoji;
Â  Â  Â  Â  Â  Â  stack.appendChild(layerDiv);
Â  Â  Â  Â  });
Â  Â  }

Â  Â  // --- Timer Logic ---

Â  Â  function resetTimer(maxTime) {
Â  Â  Â  Â  stopTimer();
Â  Â  Â  Â  GAME_STATE.timerMax = maxTime;
Â  Â  Â  Â  GAME_STATE.elapsedTime = 0;
Â  Â  Â  Â  elements.timerBarFill.style.width = '100%';
Â  Â  Â  Â  elements.timerBarFill.classList.remove('bg-yellow-500', 'bg-red-500');
Â  Â  Â  Â  elements.timerBarFill.classList.add('bg-green-500');

Â  Â  Â  Â  if (maxTime > 0) {
Â  Â  Â  Â  Â  Â  timerInterval = setInterval(updateTimer, 100);
Â  Â  Â  Â  }
Â  Â  }

Â  Â  function updateTimer() {
Â  Â  Â  Â  if (!GAME_STATE.isGameRunning || !GAME_STATE.currentOrder) {
Â  Â  Â  Â  Â  Â  stopTimer();
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }

Â  Â  Â  Â  GAME_STATE.elapsedTime += 100;
Â  Â  Â  Â  const remainingTime = GAME_STATE.timerMax - GAME_STATE.elapsedTime;
Â  Â  Â  Â  const percentage = (remainingTime / GAME_STATE.timerMax) * 100;

Â  Â  Â  Â  if (remainingTime <= 0) {
Â  Â  Â  Â  Â  Â  elements.customerWaitTimer.textContent = 'CLIENTE FOI EMBORA ğŸ˜”';
Â  Â  Â  Â  Â  Â  stopTimer();
Â  Â  Â  Â  Â  Â  handleWrongOrder("O cliente ficou impaciente e foi embora!");
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }

Â  Â  Â  Â  // Atualiza Barra e Texto
Â  Â  Â  Â  elements.timerBarFill.style.width = `${percentage}%`;
Â  Â  Â  Â  const seconds = Math.floor(remainingTime / 1000);
Â  Â  Â  Â  const minutes = Math.floor(seconds / 60);
Â  Â  Â  Â  const secs = seconds % 60;
Â  Â  Â  Â  elements.customerWaitTimer.textContent = `CLIENTE AGUARDANDO A (${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')})`;

Â  Â  Â  Â  // Muda a cor
Â  Â  Â  Â  elements.timerBarFill.classList.remove('bg-green-500', 'bg-yellow-500', 'bg-red-500');
Â  Â  Â  Â  if (percentage > 50) {
Â  Â  Â  Â  Â  Â  elements.timerBarFill.classList.add('bg-green-500');
Â  Â  Â  Â  } else if (percentage > 20) {
Â  Â  Â  Â  Â  Â  elements.timerBarFill.classList.add('bg-yellow-500');
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  elements.timerBarFill.classList.add('bg-red-500');
Â  Â  Â  Â  }
Â  Â  }

Â  Â  function stopTimer() {
Â  Â  Â  Â  clearInterval(timerInterval);
Â  Â  Â  Â  timerInterval = null;
Â  Â  }

Â  Â  // --- Helper Functions ---

Â  Â  function getRandomPraisePhrase() {
Â  Â  Â  Â  return PRAISE_PHRASES[Math.floor(Math.random() * PRAISE_PHRASES.length)];
Â  Â  }

Â  Â  function getRandomCustomerEmoji() {
Â  Â  Â  Â  const emojis = ['ğŸ§‘â€ğŸ¤â€ğŸ§‘', 'ğŸ„â€â™‚ï¸', 'ğŸ¨', 'ğŸ–ï¸', 'ğŸ§‘â€ğŸ¦³', 'ğŸ‘©â€ğŸ¦°', 'ğŸ§”â€â™‚ï¸', 'ğŸ‘µ', 'ğŸ‘¨â€ğŸ¦±', 'ğŸ‘©â€ğŸ¤'];
Â  Â  Â  Â  return emojis[Math.floor(Math.random() * emojis.length)];
Â  Â  }

Â  Â  function resetPizzaBench() {
Â  Â  Â  Â  GAME_STATE.appliedIngredients = [];
Â  Â  Â  Â  elements.feedbackText.textContent = "Aguardando entrega...";
Â  Â  Â  Â  elements.gameMessage.textContent = PHASES[GAME_STATE.currentPhase].message;
Â  Â  Â  Â  elements.currentOrderName.textContent = "...";
Â  Â  Â  Â  elements.customerAvatar.textContent = "ğŸ§‘â€ğŸ¤â€ğŸ§‘";
Â  Â  Â  Â  renderPizzaStack();
Â  Â  }

Â  Â  function displayMessage(text, classes = 'text-gray-800') {
Â  Â  Â  Â  elements.gameMessage.textContent = text;
Â  Â  Â  Â  elements.gameMessage.className = `mt-3 text-center text-xl font-semibold ${classes}`;
Â  Â  }

Â  Â  function showModal(title, body, actionType, isSuccess = false) {
Â  Â  Â  Â  elements.modalTitle.textContent = title;
Â  Â  Â  Â  elements.modalBody.textContent = body;
Â  Â  Â  Â  elements.modalActions.innerHTML = '';
Â  Â  Â  Â  elements.gameModal.classList.remove('hidden');

Â  Â  Â  Â  elements.modalTitle.classList.remove('text-aussie-green', 'text-red-600');
Â  Â  Â  Â  elements.modalTitle.classList.add(isSuccess ? 'text-aussie-green' : 'text-red-600');

Â  Â  Â  Â  if (actionType === 'nextPhase') {
Â  Â  Â  Â  Â  Â  const nextBtn = document.createElement('button');
Â  Â  Â  Â  Â  Â  nextBtn.className = "bg-aussie-green text-white font-bold py-3 px-6 rounded-full text-lg transition duration-150 hover:bg-aussie-orange";
Â  Â  Â  Â  Â  Â  nextBtn.textContent = `ComeÃ§ar Dia ${GAME_STATE.currentPhase} ğŸš€`;
Â  Â  Â  Â  Â  Â  nextBtn.onclick = () => { hideModal(); startPhase(); helberSpeak(PHASES[GAME_STATE.currentPhase].message); };
Â  Â  Â  Â  Â  Â  elements.modalActions.appendChild(nextBtn);
Â  Â  Â  Â  } else if (actionType === 'endGame') {
Â  Â  Â  Â  Â  Â  const restartBtn = document.createElement('button');
Â  Â  Â  Â  Â  Â  restartBtn.className = "bg-aussie-orange text-white font-bold py-3 px-6 rounded-full text-lg transition duration-150 hover:bg-aussie-green";
Â  Â  Â  Â  Â  Â  restartBtn.textContent = 'RecomeÃ§ar Dia 1 ğŸ•';
Â  Â  Â  Â  Â  Â  restartBtn.onclick = startGame;
Â  Â  Â  Â  Â  Â  elements.modalActions.appendChild(restartBtn);
Â  Â  Â  Â  }
Â  Â  }

Â  Â  function hideModal() {
Â  Â  Â  Â  elements.gameModal.classList.add('hidden');
Â  Â  }

Â  Â  // --- Visual Effects ---

Â  Â  function animatePizzaDelivery() {
Â  Â  Â  Â  const layers = elements.pizzaStack.querySelectorAll('.pizza-layer');
Â  Â  Â  Â  layers.forEach((layer, index) => {
Â  Â  Â  Â  Â  Â  layer.style.transition = 'transform 0.5s ease-in, opacity 0.5s ease-in';
Â  Â  Â  Â  Â  Â  // Move para cima e desaparece
Â  Â  Â  Â  Â  Â  layer.style.transform = `translateY(-300px) scale(0.5)`;
Â  Â  Â  Â  Â  Â  layer.style.opacity = '0';
Â  Â  Â  Â  Â  Â  layer.style.transitionDelay = `${index * 0.05}s`;
Â  Â  Â  Â  });
Â  Â  }

Â  Â  function animatePizzaExplosion() {
Â  Â  Â  Â  const layers = elements.pizzaStack.querySelectorAll('.pizza-layer');
Â  Â  Â  Â  layers.forEach((layer, index) => {
Â  Â  Â  Â  Â  Â  // PosiÃ§Ã£o de explosÃ£o aleatÃ³ria
Â  Â  Â  Â  Â  Â  const randX = (Math.random() - 0.5) * 300;
Â  Â  Â  Â  Â  Â  const randY = (Math.random() - 1) * 300;
Â  Â  Â  Â  Â  Â  layer.style.transition = 'transform 0.5s ease-out, opacity 0.5s ease-out';
Â  Â  Â  Â  Â  Â  layer.style.transform = `translate(${randX}px, ${randY}px) rotate(${Math.random() * 360}deg) scale(0.1)`;
Â  Â  Â  Â  Â  Â  layer.style.opacity = '0';
Â  Â  Â  Â  Â  Â  layer.style.transitionDelay = `${index * 0.03}s`;
Â  Â  Â  Â  });
Â  Â  }


Â  Â  function animateFireworks() {
Â  Â  Â  Â  for (let i = 0; i < 20; i++) {
Â  Â  Â  Â  Â  Â  const firework = document.createElement('div');
Â  Â  Â  Â  Â  Â  firework.className = 'firework';
Â  Â  Â  Â  Â  Â  // Gera em cima do modal
Â  Â  Â  Â  Â  Â  const startX = elements.gameModal.clientWidth / 2;
Â  Â  Â  Â  Â  Â  const startY = elements.gameModal.clientHeight / 2;

Â  Â  Â  Â  Â  Â  firework.style.left = `${startX}px`;
Â  Â  Â  Â  Â  Â  firework.style.top = `${startY}px`;

Â  Â  Â  Â  Â  Â  const randX = (Math.random() - 0.5) * 400;
Â  Â  Â  Â  Â  Â  const randY = (Math.random() - 0.5) * 400;
Â  Â  Â  Â  Â  Â  firework.style.setProperty('--x', `${randX}px`);
Â  Â  Â  Â  Â  Â  firework.style.setProperty('--y', `${randY}px`);

Â  Â  Â  Â  Â  Â  firework.style.backgroundColor = `hsl(${Math.random() * 360}, 100%, 50%)`;
Â  Â  Â  Â  Â  Â  firework.style.animationDelay = `${Math.random() * 0.3}s`;
Â  Â  Â  Â  Â  Â  elements.gameModal.appendChild(firework);
Â Â  Â  Â  Â  Â  Â 
Â  Â  Â  Â  Â  Â  setTimeout(() => firework.remove(), 1000);
Â  Â  Â  Â  }
Â  Â  }

Â  Â  // --- Initialization ---
Â  Â  elements.startGameBtn.onclick = startGame;
Â  Â  initFirebase();

Â  Â  // Exibe o modal inicial (ObrigatÃ³rio)
Â  Â  if (!GAME_STATE.isGameRunning) {
Â  Â  Â  Â  showModal("Bem-vindo, Mate!",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  "Pressione Iniciar para comeÃ§ar sua jornada como o Pizzaiolo Helber B!",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'startGame');
Â  Â  }
</script>
</body>
</html>
