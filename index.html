<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pizzaria Helber B: Australian Man</title>
    <style>
        /* ESTILOS CSS - Design "Cartoon Cute" e Tema Austr√°lia */
        :root {
            --color-bg-body: #008080; /* Teal - Oceano Australiano */
            --color-bg-container: #ff9933; /* Laranja/Terra de Outback */
            --color-border-dark: #000;
            --color-border-medium: #333;
            --color-panel-bg: #fff;
            --color-text-dark: #333;
            --color-text-light: #fff;
            --color-header-bg: #8b0000; /* Vermelho Pizza */
            --color-header-text: #ffd700; /* Ouro */
            --color-kitchen-bg: #a0522d; /* Marrom Bancada */
            --color-pizza-dough: #fce8a6; /* Massa */
            --color-sauce: #ff0000; /* Molho Vermelho */
            --color-cheese: #ffd700; /* Queijo Amarelo */
            --color-pepperoni: #dc143c; /* Pepperoni Escuro */
            --color-manjericao: #008000; /* Manjeric√£o Verde */
            --color-pimentao: #00a000; /* Piment√£o Verde Claro */
            --color-button-normal: #8b0000;
            --color-button-finish: #3cb371;
            --color-button-text: #fff;
        }

        body {
            font-family: 'Comic Sans MS', 'Arial Black', Gadget, sans-serif;
            background: linear-gradient(135deg, var(--color-bg-body) 0%, #339999 100%);
            color: var(--color-text-light);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            text-shadow: 2px 2px 3px rgba(0,0,0,0.3);
            overflow-x: hidden;
        }

        #header {
            width: 100%;
            max-width: 1240px;
            background-color: var(--color-header-bg);
            border: 10px solid var(--color-border-dark);
            border-radius: 20px;
            padding: 10px 20px;
            margin-bottom: 25px;
            text-align: center;
            box-shadow: 10px 10px 0 var(--color-border-dark);
            color: var(--color-header-text);
            position: relative;
            z-index: 10;
        }
        
        #header h1 {
            margin: 5px 0;
            font-size: 3em;
            line-height: 1;
            text-transform: uppercase;
        }

        #header p {
            font-size: 1.2em;
            margin-top: 5px;
            color: #ffeeaa;
        }

        #game-info {
            display: flex;
            justify-content: space-around;
            font-size: 1.3em;
            margin-top: 15px;
            color: var(--color-text-light);
            background-color: rgba(0,0,0,0.2);
            padding: 8px 0;
            border-radius: 10px;
            border: 2px dashed rgba(255,255,255,0.5);
        }

        #game-container {
            display: flex;
            width: 100%;
            max-width: 1200px;
            gap: 25px;
            background: linear-gradient(180deg, var(--color-bg-container) 0%, #ff8c00 100%);
            border: 15px solid var(--color-border-dark);
            border-radius: 30px;
            padding: 25px;
            box-shadow: 15px 15px 0 var(--color-border-dark);
            position: relative;
            z-index: 5;
        }

        .panel {
            background-color: var(--color-panel-bg);
            padding: 20px;
            border-radius: 20px;
            border: 7px solid var(--color-border-medium);
            box-shadow: 8px 8px 0 var(--color-border-medium);
            color: var(--color-text-dark);
            min-height: 300px;
            display: flex;
            flex-direction: column;
        }

        h2 {
            font-size: 1.8em;
            color: var(--color-header-bg);
            margin-top: 0;
            margin-bottom: 15px;
            text-align: center;
            text-shadow: 1px 1px 0 rgba(0,0,0,0.1);
        }

        /* Menu de Receitas */
        #recipe-menu {
            width: 280px;
        }

        .recipe {
            margin-bottom: 12px;
            border-bottom: 2px dashed #ccc;
            padding-bottom: 8px;
            font-weight: bold;
            font-size: 1.1em;
        }

        .recipe-ingredients {
            font-size: 0.9em;
            color: #666;
            font-weight: normal;
        }
        
        /* Cozinha */
        #kitchen {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            background-color: var(--color-kitchen-bg);
            border: 7px solid var(--color-border-dark);
            border-radius: 20px;
            padding: 20px;
            box-shadow: 8px 8px 0 var(--color-border-dark);
        }

        #pizza-oven-area {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        #pizza-base {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            background-color: var(--color-pizza-dough);
            border: 7px dashed #666;
            position: relative;
            overflow: hidden; /* Para as camadas ficarem dentro */
            box-shadow: inset 0 0 15px rgba(0,0,0,0.2);
        }

        .ingredient-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            opacity: 0; /* Inicia invis√≠vel */
            transition: opacity 0.3s ease-in-out;
        }
        
        #sauce-layer { background-color: var(--color-sauce); }
        #cheese-layer { background-color: var(--color-cheese); }
        #pepperoni-layer { background-image: radial-gradient(circle, var(--color-pepperoni) 25%, transparent 30%), radial-gradient(circle, var(--color-pepperoni) 25%, transparent 30%), radial-gradient(circle, var(--color-pepperoni) 25%, transparent 30%); background-size: 33% 33%; background-position: 0% 0%, 50% 25%, 100% 50%;} /* Pequenos c√≠rculos de pepperoni */
        #manjericao-layer { background-image: radial-gradient(circle, var(--color-manjericao) 20%, transparent 25%), radial-gradient(circle, var(--color-manjericao) 20%, transparent 25%); background-size: 25% 25%; background-position: 10% 20%, 60% 70%;} /* Folhas de manjeric√£o */
        #pimentao-layer { background-image: linear-gradient(45deg, var(--color-pimentao) 0%, transparent 50%), linear-gradient(135deg, var(--color-pimentao) 0%, transparent 50%); background-size: 25% 25%; background-position: 10% 10%, 70% 60%;} /* Piment√£o */


        #current-sequence-display {
            font-size: 1.1em;
            color: var(--color-text-dark);
            font-weight: bold;
            background-color: #f0f0f0;
            padding: 8px 12px;
            border-radius: 10px;
            border: 2px dashed #999;
            min-height: 20px;
            text-align: center;
        }

        #ingredient-buttons {
            display: flex;
            flex-wrap: wrap; /* Permite quebrar linha */
            justify-content: center;
            gap: 10px;
            margin-top: 15px;
        }

        .ing-btn {
            padding: 12px 18px;
            font-size: 1.1em;
            cursor: pointer;
            border: 4px solid var(--color-border-dark);
            border-radius: 12px;
            background-color: var(--color-button-normal);
            color: var(--color-button-text);
            box-shadow: 5px 5px 0 var(--color-border-dark);
            transition: transform 0.1s, background-color 0.2s;
            font-weight: bold;
            text-transform: uppercase;
        }

        .ing-btn:hover {
            background-color: #a00000;
        }

        .ing-btn:active {
            transform: translate(5px, 5px);
            box-shadow: none;
        }

        #finish-btn {
            background-color: var(--color-button-finish);
            margin-top: 20px;
            font-size: 1.3em;
            padding: 15px 25px;
        }
        #finish-btn:hover {
            background-color: #4cd481;
        }

        /* Painel de Pedidos e Status */
        #status-panel {
            width: 280px;
            justify-content: space-between; /* Empurra o status para baixo */
        }

        #order-queue {
            flex-grow: 1; /* Permite que a fila cres√ßa */
            max-height: 250px; /* Limite de altura */
            overflow-y: auto;
            margin-bottom: 15px;
            padding-right: 5px; /* Para scrollbar n√£o cobrir conte√∫do */
        }

        .order {
            padding: 10px;
            margin-bottom: 10px;
            border: 3px solid #666;
            border-radius: 10px;
            background-color: #f8f8f8;
            box-shadow: 2px 2px 0 #999;
            font-size: 0.95em;
        }

        .order.current-customer {
            border-color: var(--color-header-bg);
            background-color: #ffe0b2; /* Laranja claro */
        }

        .pizza-item {
            font-weight: bold;
            color: var(--color-header-bg);
            display: block; /* Cada pizza em uma nova linha */
            margin-top: 3px;
        }

        .pizza-item.completed {
            text-decoration: line-through;
            color: #999;
        }

        #current-order-display {
            background-color: #ffe0b2; /* Laranja pastel */
            border: 3px dashed var(--color-header-bg);
            border-radius: 10px;
            padding: 10px;
            margin-top: auto; /* Empurra para o fundo do painel */
            text-align: center;
        }
        #current-order-display p {
            margin: 5px 0;
        }

        /* Estilos para mensagens de feedback */
        #feedback-message {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 20px 40px;
            border-radius: 15px;
            font-size: 2em;
            font-weight: bold;
            text-align: center;
            z-index: 100;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease-in-out;
            border: 5px solid yellow;
            box-shadow: 0 0 20px rgba(255,255,0,0.5);
        }

        /* Efeito de flash na tela para erro */
        .error-flash {
            animation: flashRed 0.3s ease-out;
        }

        @keyframes flashRed {
            0% { box-shadow: 0 0 20px 10px red; }
            50% { box-shadow: 0 0 20px 10px red; }
            100% { box-shadow: none; }
        }

        /* Overlay de fim de dia/jogo */
        #game-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 200;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.5s ease-in-out;
        }

        #overlay-content {
            background-color: #ffeeaa;
            color: var(--color-text-dark);
            padding: 40px;
            border-radius: 20px;
            border: 10px solid var(--color-border-dark);
            box-shadow: 15px 15px 0 var(--color-border-dark);
            text-align: center;
            transform: scale(0.8);
            opacity: 0;
            transition: transform 0.5s ease, opacity 0.5s ease;
        }

        #game-overlay.active {
            opacity: 1;
            pointer-events: all;
        }
        #game-overlay.active #overlay-content {
            opacity: 1;
            transform: scale(1);
        }

        #overlay-content button {
            background-color: var(--color-button-finish);
            color: var(--color-button-text);
            border: 4px solid var(--color-border-dark);
            border-radius: 10px;
            padding: 15px 30px;
            font-size: 1.5em;
            font-weight: bold;
            cursor: pointer;
            margin-top: 20px;
            box-shadow: 5px 5px 0 var(--color-border-dark);
            transition: transform 0.1s, background-color 0.2s;
        }

        #overlay-content button:hover {
            background-color: #4cd481;
        }

        #overlay-content button:active {
            transform: translate(5px, 5px);
            box-shadow: none;
        }

        /* Scrollbar estilo cartoon */
        ::-webkit-scrollbar {
            width: 12px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1; 
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #888; 
            border-radius: 10px;
            border: 2px solid #f1f1f1;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #555; 
        }

    </style>
</head>
<body>

    <div id="header">
        <h1>PIZZARIA HELBER B: AUSTRALIAN MAN üê®</h1>
        <p>A mais selvagem pizzaria do OutBack! Cuidado com os Dingos!</p>
        <div id="game-info">
            <span id="day-counter">Dia 1 - Fase 1</span>
            <span id="timer">Tempo: 90s</span>
            <span id="cash-display">Caixa: $0</span>
            <span id="reputation-display">Reputa√ß√£o: ‚òÖ‚òÖ‚òÖ</span>
        </div>
    </div>

    <div id="game-container">

        <div id="recipe-menu" class="panel">
            <h2>üìú Menu de Receitas</h2>
            <div id="recipes-list">
                </div>
        </div>

        <div id="kitchen" class="panel">
            <h2>üë®‚Äçüç≥ Bancada de Preparo</h2>
            <div id="pizza-oven-area">
                <div id="pizza-base">
                    <div id="sauce-layer" class="ingredient-layer"></div>
                    <div id="cheese-layer" class="ingredient-layer"></div>
                    <div id="pepperoni-layer" class="ingredient-layer"></div>
                    <div id="manjericao-layer" class="ingredient-layer"></div>
                    <div id="pimentao-layer" class="ingredient-layer"></div>
                </div>
                <p id="current-sequence-display">Prepare sua pizza!</p>
            </div>

            <div id="ingredient-buttons">
                <button class="ing-btn" data-ingredient="Massa" onclick="addIngredient('Massa')">Massa</button>
                <button class="ing-btn" data-ingredient="Molho" onclick="addIngredient('Molho')">Molho</button>
                <button class="ing-btn" data-ingredient="Queijo" onclick="addIngredient('Queijo')">Queijo</button>
                <button class="ing-btn" data-ingredient="Pepperoni" onclick="addIngredient('Pepperoni')">Pepperoni</button>
                <button class="ing-btn" data-ingredient="Piment√£o" onclick="addIngredient('Piment√£o')">Piment√£o</button>
                <button class="ing-btn" data-ingredient="Manjeric√£o" onclick="addIngredient('Manjeric√£o')">Manjeric√£o</button>
            </div>
            <button id="finish-btn" onclick="finishPizza()">üî• FORNO & ENTREGA!</button>
        </div>

        <div id="status-panel" class="panel">
            <h2>ü¶ò Fila de Pedidos</h2>
            <div id="order-queue">
                <p>Aguardando o primeiro cliente...</p>
            </div>
            <div id="current-order-display">
                <p>üê® **Pr√≥xima Pizza:**</p>
                <p id="current-pizza-type-display">-</p>
            </div>
        </div>

    </div>

    <div id="feedback-message"></div>

    <div id="game-overlay">
        <div id="overlay-content">
            <h2 id="overlay-title">Fim do Dia!</h2>
            <p id="overlay-message">Resultados do dia...</p>
            <button id="overlay-button" onclick="handleOverlayButtonClick()">Continuar</button>
        </div>
    </div>

    <script>
        // --- JAVASCRIPT DO JOGO ---

        // --- Vari√°veis Globais de Jogo ---
        let cash = 0;
        let reputation = 3; // Estrelas
        let dayTime = 90; // Tempo em segundos por dia
        let timerInterval;
        let dayCounter = 1;
        let currentPhase = 1;
        const MAX_REPUTATION = 5;
        const MIN_REPUTATION = 0;
        const INITIAL_DAY_TIME = 90; // Tempo inicial por dia
        const ORDERS_PER_DAY_BASE = 5; // Pedidos base por dia

        const RECIPES = {
            'Margherita': ['Massa', 'Molho', 'Queijo', 'Manjeric√£o'],
            'Pepperoni': ['Massa', 'Molho', 'Queijo', 'Pepperoni'],
            'Helber Veggie': ['Massa', 'Molho', 'Queijo', 'Piment√£o'],
            'Aussie Supreme': ['Massa', 'Molho', 'Queijo', 'Pepperoni', 'Piment√£o'] // Uma receita mais complexa
        };

        const PIZZA_PRICES = {
            'Margherita': 10,
            'Pepperoni': 12,
            'Helber Veggie': 11,
            'Aussie Supreme': 15
        };

        let orderQueue = []; // Fila de pedidos (clientes)
        let currentCustomerOrder = null; // O pedido completo do cliente atual
        let currentPizzaBeingMade = { // Detalhes da pizza sendo feita
            type: '',
            ingredientsAdded: [],
            requiredIngredients: []
        };
        let pizzaCountToday = 0; // Contador de pizzas feitas no dia

        // --- Elementos DOM ---
        const cashDisplay = document.getElementById('cash-display');
        const reputationDisplay = document.getElementById('reputation-display');
        const timerDisplay = document.getElementById('timer');
        const dayCounterDisplay = document.getElementById('day-counter');
        const recipesList = document.getElementById('recipes-list');
        const orderQueueDisplay = document.getElementById('order-queue');
        const currentOrderDisplay = document.getElementById('current-order-display');
        const currentPizzaTypeDisplay = document.getElementById('current-pizza-type-display');
        const currentSequenceDisplay = document.getElementById('current-sequence-display');
        const feedbackMessage = document.getElementById('feedback-message');
        const gameContainer = document.getElementById('game-container');
        const gameOverlay = document.getElementById('game-overlay');
        const overlayTitle = document.getElementById('overlay-title');
        const overlayMessage = document.getElementById('overlay-message');
        const overlayButton = document.getElementById('overlay-button');

        // Camadas visuais da pizza
        const sauceLayer = document.getElementById('sauce-layer');
        const cheeseLayer = document.getElementById('cheese-layer');
        const pepperoniLayer = document.getElementById('pepperoni-layer');
        const manjericaoLayer = document.getElementById('manjericao-layer');
        const pimentaoLayer = document.getElementById('pimentao-layer');
        const pizzaLayers = {
            'Molho': sauceLayer,
            'Queijo': cheeseLayer,
            'Pepperoni': pepperoniLayer,
            'Manjeric√£o': manjericaoLayer,
            'Piment√£o': pimentaoLayer
        };


        // --- Fun√ß√µes de Jogo ---

        function initGame() {
            renderRecipes();
            startGame();
        }

        function renderRecipes() {
            recipesList.innerHTML = '';
            for (const type in RECIPES) {
                const div = document.createElement('div');
                div.className = 'recipe';
                div.innerHTML = `**${type}:** <div class="recipe-ingredients">${RECIPES[type].join(' > ')}</div>`;
                recipesList.appendChild(div);
            }
        }

        function updateUI() {
            cashDisplay.textContent = `Caixa: $${cash}`;
            reputationDisplay.textContent = `Reputa√ß√£o: ${'‚òÖ'.repeat(reputation)}${'‚òÜ'.repeat(MAX_REPUTATION - reputation)}`;
            dayCounterDisplay.textContent = `Dia ${dayCounter} - Fase ${currentPhase}`;
            currentSequenceDisplay.textContent = currentPizzaBeingMade.ingredientsAdded.length > 0 ?
                                                    currentPizzaBeingMade.ingredientsAdded.join(' > ') : "Comece pela Massa!";

            if (currentCustomerOrder && currentPizzaBeingMade.type) {
                currentPizzaTypeDisplay.innerHTML = `${currentCustomerOrder.customerName}<br>Pede: <span style="color:${var(--color-header-bg)}">${currentPizzaBeingMade.type}</span>`;
            } else {
                currentPizzaTypeDisplay.textContent = '-';
            }
        }

        function showFeedback(message, isError = false) {
            feedbackMessage.textContent = message;
            feedbackMessage.style.opacity = 1;
            if (isError) {
                gameContainer.classList.add('error-flash');
            }
            setTimeout(() => {
                feedbackMessage.style.opacity = 0;
                gameContainer.classList.remove('error-flash');
            }, 1500);
        }

        function startGame() {
            cash = 0;
            reputation = 3;
            dayCounter = 1;
            currentPhase = 1;
            orderQueue = [];
            currentCustomerOrder = null;
            pizzaCountToday = 0;
            startDay();
        }

        function startDay() {
            dayTime = INITIAL_DAY_TIME; // Resetar o tempo
            pizzaCountToday = 0;
            orderQueue = []; // Limpa fila de pedidos
            currentCustomerOrder = null;
            resetPizzaBeingMade(); // Limpa a pizza na bancada
            updateUI();
            renderOrderQueue(); // Limpa a UI da fila

            // Gera pedidos para o dia (at√© 25 em teoria, mas faremos uns 5-7 para demonstra√ß√£o)
            const numOrdersToday = Math.floor(ORDERS_PER_DAY_BASE + (currentPhase - 1) * 1.5);
            for (let i = 0; i < numOrdersToday; i++) {
                setTimeout(() => generateCustomerOrder(), i * (Math.random() * 5000 + 3000)); // Chegada entre 3 e 8 segundos
            }

            // Inicia o timer do dia
            clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                dayTime--;
                timerDisplay.textContent = `Tempo: ${dayTime}s`;
                if (dayTime <= 0) {
                    endDay();
                }
            }, 1000);

            // Garante que o primeiro pedido seja processado se j√° houver na fila
            if (!currentCustomerOrder && orderQueue.length > 0) {
                processNextCustomerOrder();
            }
        }

        function endDay() {
            clearInterval(timerInterval);
            let dayResultText = `Voc√™ serviu ${pizzaCountToday} pizzas hoje.\n`;
            let successMessage = "Excelente! Voc√™ passou para o pr√≥ximo dia!";
            let failMessage = "Oh n√£o! Voc√™ n√£o atingiu a meta. Tente novamente!";

            // L√≥gica de meta simplificada: pelo menos 3 pizzas e reputa√ß√£o n√£o m√≠nima
            const targetPizzas = ORDERS_PER_DAY_BASE + (currentPhase - 1);
            if (pizzaCountToday >= targetPizzas && reputation > 1) {
                overlayTitle.textContent = "Dia Conclu√≠do! ‚òÄÔ∏è";
                overlayMessage.innerHTML = `${dayResultText}Sua meta era ${targetPizzas} pizzas.<br>${successMessage}`;
                overlayButton.textContent = "Avan√ßar para o Pr√≥ximo Dia";
                dayCounter++;
                if (dayCounter > 3) {
                    dayCounter = 1;
                    currentPhase++;
                    overlayTitle.textContent = "Fase Conclu√≠da! üèÜ";
                    overlayMessage.innerHTML = `${dayResultText}Voc√™ concluiu a Fase ${currentPhase - 1}! Preparado para a Fase ${currentPhase}?`;
                    overlayButton.textContent = "Iniciar Nova Fase";
                }
            } else {
                overlayTitle.textContent = "Dia Fracassado! üåßÔ∏è";
                overlayMessage.innerHTML = `${dayResultText}Sua meta era ${targetPizzas} pizzas.<br>${failMessage}`;
                overlayButton.textContent = "Tentar o Dia Novamente";
                // Reputa√ß√£o e caixa s√£o mantidos para a pr√≥xima tentativa do dia
            }
            
            showOverlay();
        }

        function showOverlay() {
            gameOverlay.classList.add('active');
        }

        function hideOverlay() {
            gameOverlay.classList.remove('active');
        }

        function handleOverlayButtonClick() {
            hideOverlay();
            if (overlayButton.textContent.includes("Tentar o Dia Novamente")) {
                startDay(); // Recome√ßa o mesmo dia
            } else {
                startDay(); // Avan√ßa para o pr√≥ximo dia ou fase
            }
        }

        function generateCustomerOrder() {
            const pizzaTypes = Object.keys(RECIPES);
            const numPizzas = Math.random() < 0.3 + (currentPhase * 0.1) ? 2 : 1; // Chance maior de 2 pizzas em fases mais avan√ßadas
            const pizzasForCustomer = [];

            for (let i = 0; i < numPizzas; i++) {
                const type = pizzaTypes[Math.floor(Math.random() * pizzaTypes.length)];
                pizzasForCustomer.push({ type: type, completed: false });
            }

            const customerId = Math.floor(Math.random() * 100000); // ID √∫nico
            const customerNames = ["Dingo Dave", "Kangaroo Kate", "Koala Kevin", "Wombat Wendy", "Crocodile Cody"];
            const randomName = customerNames[Math.floor(Math.random() * customerNames.length)];

            orderQueue.push({
                id: customerId,
                customerName: randomName,
                pizzas: pizzasForCustomer,
                orderTime: dayTime // Para calcular b√¥nus por rapidez
            });
            showFeedback(`Novo pedido de ${randomName}! üçï`);
            renderOrderQueue();

            if (!currentCustomerOrder) {
                processNextCustomerOrder();
            }
        }

        function renderOrderQueue() {
            orderQueueDisplay.innerHTML = '';
            if (orderQueue.length === 0) {
                orderQueueDisplay.innerHTML = '<p>Nenhum cliente na fila.</p>';
                return;
            }

            orderQueue.forEach(order => {
                const div = document.createElement('div');
                div.className = 'order';
                if (order === currentCustomerOrder) {
                    div.classList.add('current-customer');
                }
                
                let pizzasHtml = order.pizzas.map(p => `
                    <span class="pizza-item ${p.completed ? 'completed' : ''}">
                        ${p.completed ? '‚úÖ' : 'üëâ'} ${p.type}
                    </span>
                `).join('');

                div.innerHTML = `<strong>${order.customerName}:</strong> ${pizzasHtml}`;
                orderQueueDisplay.appendChild(div);
            });
        }

        function processNextCustomerOrder() {
            if (orderQueue.length > 0) {
                currentCustomerOrder = orderQueue[0];
                // Encontrar a primeira pizza N√ÉO completa deste cliente para fazer
                const nextPizzaToMake = currentCustomerOrder.pizzas.find(p => !p.completed);

                if (nextPizzaToMake) {
                    currentPizzaBeingMade.type = nextPizzaToMake.type;
                    currentPizzaBeingMade.requiredIngredients = [...RECIPES[nextPizzaToMake.type]];
                    resetPizzaVisuals();
                    showFeedback(`Comece a fazer a pizza ${currentPizzaBeingMade.type}!`);
                } else {
                    // Todas as pizzas do cliente atual foram feitas, ent√£o remove o cliente
                    orderQueue.shift();
                    currentCustomerOrder = null;
                    resetPizzaBeingMade(); // Limpa a bancada
                    showFeedback('Cliente atendido! Pr√≥ximo da fila...');
                    processNextCustomerOrder(); // Processa o pr√≥ximo cliente
                }
            } else {
                currentCustomerOrder = null;
                resetPizzaBeingMade();
                showFeedback('Nenhum pedido ativo no momento. Aguarde mais clientes!', false);
            }
            renderOrderQueue(); // Atualiza a fila visualmente
            updateUI();
        }

        function resetPizzaBeingMade() {
            currentPizzaBeingMade = {
                type: '',
                ingredientsAdded: [],
                requiredIngredients: []
            };
            resetPizzaVisuals();
            updateUI();
        }

        function resetPizzaVisuals() {
            for (const layer in pizzaLayers) {
                pizzaLayers[layer].style.opacity = 0;
            }
            document.getElementById('pizza-base').classList.remove('error-flash'); // Remove flash de erro
        }

        function addIngredient(ingredient) {
            if (!currentCustomerOrder || !currentPizzaBeingMade.type) {
                showFeedback("Nenhum pedido ativo! O cliente australiano vai ficar zangado, Mate!", true);
                return;
            }

            const requiredRecipe = currentPizzaBeingMade.requiredIngredients;
            const nextRequiredIngredient = requiredRecipe[currentPizzaBeingMade.ingredientsAdded.length];

            // 1. Verificar a ordem dos ingredientes
            if (ingredient !== nextRequiredIngredient) {
                showFeedback(`**ERRO!** Ordem incorreta: ${ingredient}. O pr√≥ximo deve ser ${nextRequiredIngredient}. Reputa√ß√£o cai!`, true);
                reputation = Math.max(MIN_REPUTATION, reputation - 1);
                resetPizzaBeingMade();
                return;
            }

            currentPizzaBeingMade.ingredientsAdded.push(ingredient);
            updateUI();
            
            // Atualiza visual da pizza
            if (pizzaLayers[ingredient]) {
                pizzaLayers[ingredient].style.opacity = 1;
            }
        }

        function finishPizza() {
            if (!currentCustomerOrder || !currentPizzaBeingMade.type) {
                showFeedback("Nada para entregar!", true);
                return;
            }

            const requiredRecipe = currentPizzaBeingMade.requiredIngredients;

            // 1. Verifica√ß√£o de conclus√£o
            if (currentPizzaBeingMade.ingredientsAdded.length !== requiredRecipe.length) {
                showFeedback("**PIZZA INCOMPLETA!** O cliente Helber B n√£o come massa nua. Reputa√ß√£o cai!", true);
                reputation = Math.max(MIN_REPUTATION, reputation - 1);
                resetPizzaBeingMade();
                return;
            }

            // 2. Verifica√ß√£o final da ordem
            for (let i = 0; i < requiredRecipe.length; i++) {
                if (currentPizzaBeingMade.ingredientsAdded[i] !== requiredRecipe[i]) {
                    showFeedback("Houve um erro na sequ√™ncia dos ingredientes. Reputa√ß√£o cai!", true);
                    reputation = Math.max(MIN_REPUTATION, reputation - 1);
                    resetPizzaBeingMade();
                    return;
                }
            }

            // 3. Entrega de Sucesso
            const price = PIZZA_PRICES[currentPizzaBeingMade.type];
            cash += price; // Atualiza√ß√£o instant√¢nea do Caixa
            reputation = Math.min(MAX_REPUTATION, reputation + 1); // Reputa√ß√£o sobe
            pizzaCountToday++;
            
            showFeedback(`**SUCESSO!** Entregue ${currentPizzaBeingMade.type} para ${currentCustomerOrder.customerName}. Ganhou $${price}!`, false);

            // Marca a pizza como completa no pedido do cliente
            const pizzaIndex = currentCustomerOrder.pizzas.findIndex(p => p.type === currentPizzaBeingMade.type && !p.completed);
            if (pizzaIndex !== -1) {
                currentCustomerOrder.pizzas[pizzaIndex].completed = true;
            }
            
            processNextCustomerOrder(); // Tenta fazer a pr√≥xima pizza para o mesmo cliente ou o pr√≥ximo
        }

        // --- Inicia o Jogo ao Carregar ---
        document.addEventListener('DOMContentLoaded', initGame);

    </script>
</body>
</html>
